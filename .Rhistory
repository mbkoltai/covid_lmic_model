geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
lab_fontsize
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) +
# data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=4.5,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str,size=lab_fontsize,show.legend=FALSE)) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) +
# data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
unique(summ$ifr_all_inf)
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.3) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) +
# data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
head(DIC_logllk_values,2)
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) +
# data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel&DIC_logllk_values),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) +
# data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel&  ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
fitting_params_best_estim
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) +
# data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
# SAVE
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) +
# data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),
legend.title=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
head(DIC_logllk_values,2)
# calculate likelihood, deviance, DIC
DIC_logllk_values <- left_join(right_join(summ %>% filter(compartment=="death_o") %>% select(!c(lower,upper)),
subset(fitting_incidence_modelcompare,date_within_fitting_t) %>% select(!date_within_fitting_t),by=c("date")) %>%
mutate(logllk=ifelse(!is.infinite(dpois(new_deaths,lambda=mean,log=T)),dpois(new_deaths,lambda=mean,log=T),NA)) %>%
group_by(ifr_logit_increm,seedsize) %>% summarise(sum_logllk=sum(logllk,na.rm=T), # out_bdr_daily_estimates
deviance=-2*sum_logllk,d_p=var(-2*logllk,na.rm=T)/2,DIC=deviance+d_p) %>% mutate(dummy=1), # JOINED WITH
fitting_incidence_modelcompare %>% summarise(maxval=max(new_deaths)) %>% mutate(dummy=1),by="dummy") %>% select(!dummy) %>%
mutate(DIC_str=round(DIC) ) %>% mutate(ifr_all_inf=round(sapply(ifr_logit_increm,
function(x) 1e2*sum(inv.logit(IFR_estimates_Sandmann2021$logit_ifr+x)*somalia_agegroups_IFR$agegroup_perc)),2) )
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),
legend.title=element_text(size=15)) + # DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6), # introd date labels
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
x_dodge_vals
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(4,24); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=200
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),
legend.title=element_text(size=15)) + # DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6), # introd date labels
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(5,23); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=200
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),
legend.title=element_text(size=15)) + # DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6), # introd date labels
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(4.5,22.5); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=200
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),
legend.title=element_text(size=15)) + # DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6), # introd date labels
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(4.5,24); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=200
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),
legend.title=element_text(size=15)) + # DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6), # introd date labels
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
# SAVE
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(5,24); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=200
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),
legend.title=element_text(size=15)) + # DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6), # introd date labels
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
# SAVE
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
ggplot(left_join(summ %>% filter(compartment %in% c("cases","death_o") & date<as.Date("2020-10-01")), fitting_params_best_estim %>%
select(seedsize,ifr_logit_increm,R0_fit),by=c("seedsize","ifr_logit_increm")) %>%filter(ifr_all_inf<1.6) %>%
rename(IFR=ifr_all_inf) %>% mutate(IFR=paste0(IFR,"%"))) +
# %>% filter(seedsize<500)
geom_line(aes(x=date,y=mean,color=factor(seedsize), linetype=compartment),size=1.2) + # ,alpha=factor(seedsize)
# geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(seedsize),color=factor(seedsize),linetype=compartment),alpha=0.2,size=0.4) +
geom_point(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
geom_line(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),linetype="dashed",color="black",size=0.2) +
facet_wrap(~IFR,scales="free",labeller=labeller(IFR=label_both)) + scale_alpha_manual(values=c(0.4,0.5,0.6,0.7,0.8)) +
standard_theme + theme_bw() + xlab("") + ylab("cases/deaths") +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.text=element_text(size=15)) +#legend.position="top",
scale_x_date(date_breaks="3 week",expand=expansion(0.0),limits=as.Date(c("2019-09-22","2020-10-01"))) + #
scale_y_log10(expand=expansion(0,0),limits=c(0.6,8e3)) + labs(color="seed size",fill="seed size") + # color="IFR (%)",fill="IFR (%)"
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey")  # NPIs
ggsave(paste0(parscan_mcmc_dirname,"dynamics_cases_deaths_withdata.png"),width=30,height=20,units="cm")
fitting_dates
ggplot(left_join(summ %>% filter(compartment %in% c("cases","death_o") & date<as.Date("2020-10-01")), fitting_params_best_estim %>%
select(seedsize,ifr_logit_increm,R0_fit),by=c("seedsize","ifr_logit_increm")) %>%filter(ifr_all_inf<1.6) %>%
rename(IFR=ifr_all_inf) %>% mutate(IFR=paste0(IFR,"%"))) +
# %>% filter(seedsize<500)
geom_line(aes(x=date,y=mean,color=factor(seedsize), linetype=compartment),size=1.2) + # ,alpha=factor(seedsize)
# geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(seedsize),color=factor(seedsize),linetype=compartment),alpha=0.2,size=0.4) +
geom_point(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
geom_line(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),linetype="dashed",color="black",size=0.2) +
facet_wrap(~IFR,scales="free",labeller=labeller(IFR=label_both)) + scale_alpha_manual(values=c(0.4,0.5,0.6,0.7,0.8)) +
standard_theme + theme_bw() + xlab("") + ylab("cases/deaths") +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.text=element_text(size=15)) +#legend.position="top",
scale_x_date(date_breaks="3 week",expand=expansion(0.0),limits=as.Date(c("2019-09-22","2020-08-25"))) + #
scale_y_log10(expand=expansion(0,0),limits=c(0.6,8e3)) + labs(color="seed size",fill="seed size") + # color="IFR (%)",fill="IFR (%)"
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey")  # NPIs
# SAVE
ggplot(left_join(summ %>% filter(compartment %in% c("cases","death_o") & date<as.Date("2020-10-01")), fitting_params_best_estim %>%
select(seedsize,ifr_logit_increm,R0_fit),by=c("seedsize","ifr_logit_increm")) %>%filter(ifr_all_inf<1.6) %>%
rename(IFR=ifr_all_inf) %>% mutate(IFR=paste0(IFR,"%"))) +
# %>% filter(seedsize<500)
geom_line(aes(x=date,y=mean,color=factor(seedsize), linetype=compartment),size=1.2) + # ,alpha=factor(seedsize)
# geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(seedsize),color=factor(seedsize),linetype=compartment),alpha=0.2,size=0.4) +
geom_point(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
geom_line(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),linetype="dashed",color="black",size=0.2) +
facet_wrap(~IFR,scales="free",labeller=labeller(IFR=label_both)) + scale_alpha_manual(values=c(0.4,0.5,0.6,0.7,0.8)) +
standard_theme + theme_bw() + xlab("") + ylab("cases/deaths") +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.text=element_text(size=15)) +#legend.position="top",
scale_x_date(date_breaks="3 week",expand=expansion(0.0),limits=as.Date(c("2019-09-22","2020-08-28"))) + #
scale_y_log10(expand=expansion(0,0),limits=c(0.6,8e3)) + labs(color="seed size",fill="seed size") + # color="IFR (%)",fill="IFR (%)"
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey")  # NPIs
ggsave(paste0(parscan_mcmc_dirname,"dynamics_cases_deaths_withdata.png"),width=30,height=20,units="cm")
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2,show.legend = F) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),
legend.title=element_text(size=15)) + # DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6), # introd date labels
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel & ifr_all_inf<1.6) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) +
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) + # data
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + # DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel & ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=DIC_str),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel& ifr_all_inf<1.6), # introd date labels
aes(x=x_start+x_dodge_text+4,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd. date=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel&ifr_all_inf<1.6),aes(x=x_start+x_dodge_text+x_dodge_vals[2],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=gsub("-","/",introd_date)),size=lab_fontsize,show.legend=FALSE) +
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + labs(color="IFR",fill="IFR")+
standard_theme + theme_bw() + labs(color="IFR",fill="IFR") + theme(axis.text=element_text(size=13),
axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(), axis.title=element_text(size=15),
strip.text=element_text(size=15),legend.position="top",legend.text=element_text(size=15),legend.title=element_text(size=15))
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
fitting_dates
posteriors_summary_stats %>% mutate_if(is.numeric, round)
posteriors_summary_stats %>% mutate_if(is.numeric, round,3)
View(posteriors_summary_stats %>% mutate_if(is.numeric, round,3))
posteriors_summary_stats = posteriors_summary_stats %>% mutate_if(is.numeric, round,3)
posteriors_summary_stats %>% mutate(mean_date=as.Date("2019-09-01")+mean_date)
posteriors_summary_stats %>% mutate(mean_date=as.Date("2019-09-01")+mean)
posteriors_summary_stats %>% filter(grepl("introd",name)) %>% mutate(mean_date=as.Date("2019-09-01")+mean)
View(posteriors_summary_stats %>% filter(grepl("introd",name)) %>% mutate(mean_date=as.Date("2019-09-01")+mean))
View(posteriors_summary_stats %>% filter(grepl("introd",name)) %>% mutate(mean_date=as.Date("2019-09-01")+mean,ci95_low_date=as.Date("2019-09-01")+ci95_low,ci95_up_date=as.Date("2019-09-01")+ci95_up))
write_csv(posteriors_summary_stats %>% filter(grepl("introd",name)) %>% mutate(mean_date=as.Date("2019-09-01")+mean,ci95_low_date=as.Date("2019-09-01")+ci95_low,ci95_up_date=as.Date("2019-09-01")+ci95_up),file = paste0(parscan_mcmc_dirname,"posteriors_summary_stats_introd_date.csv"))
# posteriors_summary_stats %>% filter(grepl("introd",name)) %>% mutate(mean_date=as.Date("2019-09-01")+mean,ci95_low_date=as.Date("2019-09-01")+ci95_low,ci95_up_date=as.Date("2019-09-01")+ci95_up)
write_csv(df_posteriors_parscan,paste0(parscan_mcmc_dirname,"df_posteriors_parscan.csv"))
posteriors_summary_stats = df_posteriors_parscan %>% mutate(n=row_number()) %>%
pivot_longer(!c(n,all_of(scan_params),chain,trial,lp)) %>% group_by(name,ifr_logit_increm,seedsize) %>%
summarise(mean=mean(value),median=median(value),ci95_low=quantile(value,probs=c(2.5,97.5)/1e2)[1],
ci95_up=quantile(value,probs=c(2.5,97.5)/1e2)[2],ci50_low=quantile(value,probs=c(25,75)/1e2)[1],
ci50_up=quantile(value,probs=c(25,75)/1e2)[2],post_lkl_mean=mean(lp),post_lkl_ci95_low=quantile(lp,probs=c(2.5,97.5)/1e2)[1],
post_lkl_ci95_up=quantile(lp,probs=c(2.5,97.5)/1e2)[2]) %>% mutate(name=ifelse(name %in% "introd_date",
paste0("introduction (days after ",format(as.Date(onefit$base_parameters$date0),"%d/%m/%y"),")"),name),
name=ifelse(name %in% "NPI_scale","NPI NPI_scale (0 to 1)",name)) %>% mutate_if(is.numeric,round,3)
write_csv(posteriors_summary_stats,paste0(parscan_mcmc_dirname,"posteriors_summary_stats.csv"))
dim(posteriors_summary_stats)
View(posteriors_summary_stats)
write_csv(posteriors_summary_stats,paste0(parscan_mcmc_dirname,"posteriors_summary_stats.csv"))
View(posteriors_summary_stats)
label_y_dodge=12; label_y_factor=1.03; fontsize=4.5
ggplot(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=npi_scale*max(npi_df$contact_reduction)) ) +
geom_hpline(aes(x=factor(ifr_all_inf),y=DIC,group=seedsize,color=factor(seedsize)),width=0.24, # group=CDR,alpha=factor(CDR)
position=position_dodge(width=1)) + scale_alpha_manual(values=c(0.4,0.55,0.7,0.85)) +
geom_vline(xintercept=(2:4)-0.5,size=0.2,linetype="dashed") + # facet_wrap(~seedsize,labeller=labeller(CDR=label_both),nrow = 3) +
scale_x_discrete(expand=expansion(0.1,0)) + # scale_y_log10() + # scale_y_continuous(breaks=seq(5,100,by=1)*100) +
theme_bw() + standard_theme +
theme(axis.text.x=element_text(vjust=0.5,hjust=0.95,size=12),axis.text.y=element_text(size=12),panel.grid.major.x=element_blank(),
legend.position="top",strip.text=element_text(size=15)) +
# introd date
geom_text(aes(x=factor(ifr_all_inf),y=DIC+label_y_dodge,group=seedsize,label=gsub("-","/",format(introd_date,"%d/%m/%y"))),
position=position_dodge(width=1),size=fontsize) +
# R0
geom_text(aes(x=factor(ifr_all_inf),y=DIC+label_y_dodge+14,group=seedsize,label=R0_label),position=position_dodge(width=1),size=fontsize) +
geom_text(aes(x=factor(ifr_all_inf),y=DIC-label_y_dodge,group=seedsize,label=paste0("NPI: ",round(npi_max_effect*100),"%")),
position=position_dodge(width=1),size=fontsize) + xlab("IFR (%)") + ylab("DIC") + labs(color="seedsize",alpha="CDR")
View
View(fitting_params_best_estim)
View(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=npi_scale*max(npi_df$contact_reduction)))
View(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=100*npi_scale*max(npi_df$contact_reduction)))
head(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=100*npi_scale*max(npi_df$contact_reduction)),2)
head(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=npi_scale*max(npi_df$contact_reduction)),2)
npi_df$contact_reduction
head(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=100*npi_scale*max(npi_df$contact_reduction)),2)
View(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=100*npi_scale*max(npi_df$contact_reduction)))

paste0("DIC=",DIC_str))),size=3.5,position=position_dodge(width=x_dodge_val)) +
geom_text(aes(x=factor(ifr_all_inf),y=ifelse(!grepl("introd",name),NA,ci50_low-10),label=ifelse(!grepl("introd",name),"",
gsub("^20","'",gsub("-","/",as.Date(onefit$base_parameters$date0)+median)))),size=3.5,position=position_dodge(width=x_dodge_val))
p
ggsave(paste0(parscan_mcmc_dirname,"posteriors_mean_CIs_facet",ifelse(grepl("Wrap",class(p$facet)[1]),"wrap","grid"),
"_name_NPIscale_colorcode_seedsize",".png"),width=36,height=28,units="cm") # 2019/|2020/
p<-ggplot(df_summary_plot %>% filter(ifr_all_inf<1.6 & seedsize>20),aes(x=factor(ifr_all_inf),group=seedsize)) + #
geom_linerange(aes(ymin=ci95_low,ymax=ci95_up,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),alpha=0.3,
size=hpline_val,show.legend=FALSE) +
geom_linerange(aes(ymin=ci50_low,ymax=ci50_up,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),alpha=0.6,
size=hpline_val,show.legend=FALSE) +
geom_hpline(aes(y=median,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),width=0.23,size=0.6) +
facet_wrap(~name,scales="free",labeller=labeller(ifr_all_inf=label_both),nrow=3) + # ~NPI_scale
geom_vline(xintercept=0.5+1:3,size=0.2,linetype="dashed") + theme_bw() + standard_theme + xlab("IFR (%)") +
ylab("median (CI50, CI95)") + labs(color="seedsize",caption=paste0("Burn-in: ",onefit$options$mcmc_burn_in,", Samples: ",
onefit$options$mcmc_samples," (MCMC)")) + scale_x_discrete(expand=expansion(0,0.5)) +
theme(axis.text.x=element_text(vjust=0.5,hjust=0.95,size=12),axis.text.y=element_text(size=12),panel.grid.major.x=element_blank(),legend.position="top") +
geom_text(aes(x=factor(ifr_all_inf),y=ifelse(!grepl("introd",name),NA,ci50_up+10),label=ifelse(!grepl("introd",name),"",
paste0("DIC=",DIC_str))),size=4,position=position_dodge(width=x_dodge_val)) +
geom_text(aes(x=factor(ifr_all_inf),y=ifelse(!grepl("introd",name),NA,ci50_low-10),label=ifelse(!grepl("introd",name),"",
gsub("^20","'",gsub("-","/",as.Date(onefit$base_parameters$date0)+median)))),size=4,position=position_dodge(width=x_dodge_val)); p
ggsave(paste0(parscan_mcmc_dirname,"posteriors_mean_CIs_facet",ifelse(grepl("Wrap",class(p$facet)[1]),"wrap","grid"),
"_name_NPIscale_colorcode_seedsize",".png"),width=36,height=28,units="cm") # 2019/|2020/
p<-ggplot(df_summary_plot %>% filter(ifr_all_inf<1.6 & seedsize>20),aes(x=factor(ifr_all_inf),group=seedsize)) + #
geom_linerange(aes(ymin=ci95_low,ymax=ci95_up,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),alpha=0.3,
size=hpline_val,show.legend=FALSE) +
geom_linerange(aes(ymin=ci50_low,ymax=ci50_up,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),alpha=0.6,
size=hpline_val,show.legend=FALSE) +
geom_hpline(aes(y=median,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),width=0.23,size=0.6) +
facet_wrap(~name,scales="free",labeller=labeller(ifr_all_inf=label_both),nrow=3) + # ~NPI_scale
geom_vline(xintercept=0.5+1:3,size=0.2,linetype="dashed") + theme_bw() + standard_theme + xlab("IFR (%)") +
ylab("median (CI50, CI95)") + labs(color="seedsize",caption=paste0("Burn-in: ",onefit$options$mcmc_burn_in,", Samples: ",
onefit$options$mcmc_samples," (MCMC)")) + scale_x_discrete(expand=expansion(0,0.5)) +
theme(axis.text.x=element_text(vjust=0.5,hjust=0.95,size=12),axis.text.y=element_text(size=12),panel.grid.major.x=element_blank(),
legend.position="top",strip.text=element_text(size=15)) +
geom_text(aes(x=factor(ifr_all_inf),y=ifelse(!grepl("introd",name),NA,ci50_up+10),label=ifelse(!grepl("introd",name),"",
paste0("DIC=",DIC_str))),size=4,position=position_dodge(width=x_dodge_val)) +
geom_text(aes(x=factor(ifr_all_inf),y=ifelse(!grepl("introd",name),NA,ci50_low-10),label=ifelse(!grepl("introd",name),"",
gsub("^20","'",gsub("-","/",as.Date(onefit$base_parameters$date0)+median)))),size=4,position=position_dodge(width=x_dodge_val)); p
ggsave(paste0(parscan_mcmc_dirname,"posteriors_mean_CIs_facet",ifelse(grepl("Wrap",class(p$facet)[1]),"wrap","grid"),
"_name_NPIscale_colorcode_seedsize",".png"),width=36,height=28,units="cm") # 2019/|2020/
head(df_summary_plot,2)
df_summary_plot=left_join(posteriors_summary_stats %>% filter(!name %in% "CDR") %>% group_by(name) %>%
mutate(name=ifelse(name=="R0_fit","R0",name), median_range=max(median)-min(median)),DIC_logllk_values %>% select(!c(maxval,deviance,d_p)),
by=c("seedsize","ifr_logit_increm")) %>% filter(!name %in% c("ifr_logit_intercept","IFR sympt. infections (%)")) %>%
mutate(DIC_str=paste0(round(DIC/10^floor(log10(DIC)),2),"e",floor(log10(DIC)))) %>%
mutate(ifr_all_inf=round(sapply(ifr_logit_increm,
function(x) 1e2*sum(inv.logit(IFR_estimates_Sandmann2021$logit_ifr+x)*somalia_agegroups_IFR$agegroup_perc)),2) )
df_summary_plot
unique(df_summary_plot$name)
x_dodge_val=1; hpline_val=27
p<-ggplot(df_summary_plot %>% filter(ifr_all_inf<1.6 & seedsize>20),aes(x=factor(ifr_all_inf),group=seedsize)) + #
geom_linerange(aes(ymin=ci95_low,ymax=ci95_up,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),alpha=0.3,
size=hpline_val,show.legend=FALSE) +
geom_linerange(aes(ymin=ci50_low,ymax=ci50_up,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),alpha=0.6,
size=hpline_val,show.legend=FALSE) +
geom_hpline(aes(y=median,color=factor(seedsize)),position=position_dodge(width=x_dodge_val),width=0.23,size=0.6) +
facet_wrap(~name,scales="free",labeller=labeller(ifr_all_inf=label_both),nrow=3) + # ~NPI_scale
geom_vline(xintercept=0.5+1:3,size=0.2,linetype="dashed") + theme_bw() + standard_theme + xlab("IFR (%)") +
ylab("median (CI50, CI95)") + labs(color="seedsize",caption=paste0("Burn-in: ",onefit$options$mcmc_burn_in,", Samples: ",
onefit$options$mcmc_samples," (MCMC)")) + scale_x_discrete(expand=expansion(0,0.5)) +
theme(axis.text.x=element_text(vjust=0.5,hjust=0.95,size=12),axis.text.y=element_text(size=12),panel.grid.major.x=element_blank(),
legend.position="top",strip.text=element_text(size=15)) +
geom_text(aes(x=factor(ifr_all_inf),y=ifelse(!grepl("introd",name),NA,ci50_up+10),label=ifelse(!grepl("introd",name),"",
paste0("DIC=",DIC_str))),size=4,position=position_dodge(width=x_dodge_val)) +
geom_text(aes(x=factor(ifr_all_inf),y=ifelse(!grepl("introd",name),NA,ci50_low-10),label=ifelse(!grepl("introd",name),"",
gsub("^20","'",gsub("-","/",as.Date(onefit$base_parameters$date0)+median)))),size=4,position=position_dodge(width=x_dodge_val)); p
# SAVE
ggsave(paste0(parscan_mcmc_dirname,"posteriors_mean_CIs_facet",ifelse(grepl("Wrap",class(p$facet)[1]),"wrap","grid"),
"_name_NPIscale_colorcode_seedsize",".png"),width=36,height=30,units="cm") # 2019/|2020/### ### ### ### ###
# plot attack rates
head(posteriors_summary_stats,2)
View(posteriors_summary_stats)
unique(posteriors_summary_stats$ifr_logit_increm)
View(df_summary_plot)
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(6,13); x_start=as.Date("2020-01-10"); y_stepsize=1.1
ggplot(summ %>% filter(compartment=="death_o" & seedsize==100) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) + # ,group=interaction(NPI_scale,CDR),alpha=factor(CDR)
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) +
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(CDR=label_both,seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=14),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),legend.position="top") +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==100),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=4,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values%>% filter(seedsize==100),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=paste0(DIC_str,ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),
size=4,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==100),
aes(x=x_start+x_dodge_text,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd.=",color=factor(ifr_all_inf)),size=4,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==100),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=paste0(gsub("-","/",introd_date),
ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),size=4,show.legend=FALSE) + # gsub("2020-|2019-","",introd_date)
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
# NPI labels
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",38,10),y=21.5,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=4) + scale_y_continuous(breaks=(0:12)*2,limits=c(0,22.5),expand=expansion(0,0)) +
labs(color="IFR",fill="IFR")
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(6,13); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
ggplot(summ %>% filter(compartment=="death_o" & seedsize==100) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) + # ,group=interaction(NPI_scale,CDR),alpha=factor(CDR)
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) +
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(CDR=label_both,seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top") +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==100),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values%>% filter(seedsize==100),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=paste0(DIC_str,ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),
size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==100),
aes(x=x_start+x_dodge_text,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd.=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==100),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=paste0(gsub("-","/",introd_date),
ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),size=lab_fontsize,show.legend=FALSE) + # gsub("2020-|2019-","",introd_date)
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
# NPI labels
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",38,10),y=21.5,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=lab_fontsize) + scale_y_continuous(breaks=(0:12)*2,limits=c(0,22.5),expand=expansion(0,0)) +
labs(color="IFR",fill="IFR")
# SAVE
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(6,13); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=100
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) + # ,group=interaction(NPI_scale,CDR),alpha=factor(CDR)
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) +
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(CDR=label_both,seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top") +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values%>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=paste0(DIC_str,ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),
size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd.=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=paste0(gsub("-","/",introd_date),
ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),size=lab_fontsize,show.legend=FALSE) + # gsub("2020-|2019-","",introd_date)
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
# NPI labels
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",38,10),y=21.5,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=lab_fontsize) + scale_y_continuous(breaks=(0:12)*2,limits=c(0,22.5),expand=expansion(0,0)) +
labs(color="IFR",fill="IFR")
# SAVE
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(7,15); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=100
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) + # ,group=interaction(NPI_scale,CDR),alpha=factor(CDR)
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) +
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(CDR=label_both,seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top") +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values%>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=paste0(DIC_str,ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),
size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd.=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=paste0(gsub("-","/",introd_date),
ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),size=lab_fontsize,show.legend=FALSE) + # gsub("2020-|2019-","",introd_date)
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
# NPI labels
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",38,10),y=21.5,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=lab_fontsize) + scale_y_continuous(breaks=(0:12)*2,limits=c(0,22.5),expand=expansion(0,0)) +
labs(color="IFR",fill="IFR")
# SAVE
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=18,units="cm")
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(7,15); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=500
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) + # ,group=interaction(NPI_scale,CDR),alpha=factor(CDR)
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) +
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(CDR=label_both,seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top") +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values%>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=paste0(DIC_str,ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),
size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd.=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=paste0(gsub("-","/",introd_date),
ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),size=lab_fontsize,show.legend=FALSE) + # gsub("2020-|2019-","",introd_date)
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
# NPI labels
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",38,10),y=21.5,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=lab_fontsize) + scale_y_continuous(breaks=(0:12)*2,limits=c(0,22.5),expand=expansion(0,0)) +
labs(color="IFR",fill="IFR")
# SAVE
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=18,units="cm")
y_text=16; x_dodge_text=2; y_low=7; x_dodge_vals=c(7,15); x_start=as.Date("2020-01-10"); y_stepsize=1.1; lab_fontsize=4.5
seedsize_sel=500
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) + # ,group=interaction(NPI_scale,CDR),alpha=factor(CDR)
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) +
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(CDR=label_both,seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values%>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=paste0(DIC_str,ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),
size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd.=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=paste0(gsub("-","/",introd_date),
ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),size=lab_fontsize,show.legend=FALSE) + # gsub("2020-|2019-","",introd_date)
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
# NPI labels
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",38,10),y=21.5,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=lab_fontsize) + scale_y_continuous(breaks=(0:12)*2,limits=c(0,22.5),expand=expansion(0,0)) +
labs(color="IFR",fill="IFR")
# SAVE
paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png")
seedsize_sel
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=18,units="cm")
seedsize_sel=100
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) + # ,group=interaction(NPI_scale,CDR),alpha=factor(CDR)
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) +
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(CDR=label_both,seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values%>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=paste0(DIC_str,ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),
size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd.=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=paste0(gsub("-","/",introd_date),
ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),size=lab_fontsize,show.legend=FALSE) + # gsub("2020-|2019-","",introd_date)
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
# NPI labels
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",38,10),y=21.5,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=lab_fontsize) + scale_y_continuous(breaks=(0:12)*2,limits=c(0,22.5),expand=expansion(0,0)) +
labs(color="IFR",fill="IFR")
# SAVE
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=18,units="cm")
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
seedsize_sel=500
ggplot(summ %>% filter(compartment=="death_o" & seedsize==seedsize_sel) ) +
geom_line(aes(x=date,y=mean,color=factor(round(ifr_all_inf,2)))) + # ,group=interaction(NPI_scale,CDR),alpha=factor(CDR)
geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(round(ifr_all_inf,2))),alpha=0.2) +
geom_line(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),linetype="dashed",size=0.3) +
geom_point(data=fitting_incidence_modelcompare %>% mutate(t=as.numeric(date)),aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
facet_wrap(~seedsize,labeller=labeller(CDR=label_both,seedsize=label_both),scales="free",nrow=2) + # CDR~seedsize
scale_alpha_manual(values=c(0.4,0.45,0.5,0.55)) + xlab("") + ylab("deaths (daily)") + standard_theme + theme_bw() +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
# DIC labels
geom_text(data=DIC_logllk_values %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text-3,y=as.numeric(factor(ifr_logit_increm))*y_stepsize+y_text,
label="DIC=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) + # DIC values
geom_text(data=DIC_logllk_values%>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[1],
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text,label=paste0(DIC_str,ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),
size=lab_fontsize,show.legend=FALSE) +
# introd date labels
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),
aes(x=x_start+x_dodge_text,y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,
label="introd.=",color=factor(ifr_all_inf)),size=lab_fontsize,show.legend=FALSE) +
geom_text(data=fitting_params_best_estim %>% filter(seedsize==seedsize_sel),aes(x=x_start+x_dodge_text+x_dodge_vals[2], # introd dates
y=as.numeric(factor(ifr_all_inf))*y_stepsize+y_text-y_low,label=paste0(gsub("-","/",introd_date),
ifelse(as.numeric(factor(CDR))!=length(CDR_vals),",",""))),size=lab_fontsize,show.legend=FALSE) + # gsub("2020-|2019-","",introd_date)
scale_x_date(date_breaks="1 week",limits=as.Date(c("2020-01-01","2020-10-01")),expand=expansion(0.0)) +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
# NPI labels
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",38,10),y=21.5,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=lab_fontsize) + scale_y_continuous(breaks=(0:12)*2,limits=c(0,22.5),expand=expansion(0,0)) +
labs(color="IFR",fill="IFR")
# SAVE
ggsave(paste0(parscan_mcmc_dirname,"all_dynamic_fits_NPIcolorcode_seedsize",seedsize_sel,".png"),width=36,height=22,units="cm")
ggplot(left_join(summ %>% filter(compartment %in% c("cases","death_o") & date<as.Date("2020-10-01")),
fitting_params_best_estim %>% select(seedsize,ifr_logit_increm,R0_fit),by=c("seedsize","ifr_logit_increm")) %>% filter(seedsize<500))+
geom_line(aes(x=date,y=mean,color=factor(ifr_all_inf), linetype=compartment,alpha=factor(seedsize)),size=1.2) + #
# geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(ifr_all_inf),linetype=compartment),alpha=0.2) +
geom_point(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
geom_line(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),linetype="dashed",color="black",size=0.2) +
scale_alpha_manual(values=c(0.4,0.5,0.6,0.7,0.8)) + # facet_wrap(~seedsize,scales = "free") +
standard_theme + theme_bw() + xlab("") + ylab("cases") +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.position="top",legend.text=element_text(size=15)) +
scale_x_date(date_breaks="2 week",expand=expansion(0.0)) + # ,limits=as.Date(c("2019-10-01","2020-01-01")
scale_y_log10(expand=expansion(0,0),limits=c(0.6,1.5e4)) + labs(color="IFR (%)",fill="IFR (%)",alpha="seedsize") +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",42,15),y=1e4,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=4)
ggplot(left_join(summ %>% filter(compartment %in% c("cases","death_o") & date<as.Date("2020-10-01")),
fitting_params_best_estim %>% select(seedsize,ifr_logit_increm,R0_fit),by=c("seedsize","ifr_logit_increm")) %>% filter(seedsize<500))+
geom_line(aes(x=date,y=mean,color=factor(ifr_all_inf), linetype=compartment,alpha=factor(seedsize)),size=1.2) + #
# geom_ribbon(aes(x=date,ymin=lower,ymax=upper,fill=factor(ifr_all_inf),linetype=compartment),alpha=0.2) +
geom_point(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),fill=NA,shape=1,size=1) +
geom_line(data=fitting_incidence_modelcompare,aes(x=date,y=new_deaths),linetype="dashed",color="black",size=0.2) +
scale_alpha_manual(values=c(0.4,0.5,0.6,0.7,0.8)) + # facet_wrap(~seedsize,scales = "free") +
standard_theme + theme_bw() + xlab("") + ylab("cases") +
theme(axis.text=element_text(size=13),axis.text.x=element_text(vjust=0.5,angle=90),panel.grid.minor=element_blank(),
axis.title=element_text(size=15),strip.text = element_text(size=15),legend.text=element_text(size=15)) +#legend.position="top",
scale_x_date(date_breaks="2 week",expand=expansion(0.0)) + # ,limits=as.Date(c("2019-10-01","2020-01-01")
scale_y_log10(expand=expansion(0,0),limits=c(0.6,1.5e4)) + labs(color="IFR (%)",fill="IFR (%)",alpha="seedsize") +
geom_vline(data=npi_df,aes(xintercept=on),linetype="dashed",show.legend=F,size=0.5,color="darkgrey") + # NPIs
geom_text(data=npi_df[1:3,],aes(x=on+ifelse(name=="first",42,15),y=1e4,label=paste0(ifelse(name=="first","StringencyIndex=",""),
round(contact_reduction,2))),size=4)
ggsave(paste0(parscan_mcmc_dirname,"dynamics_cases_deaths_withdata.png"),width=30,height=20,units="cm")
label_y_dodge=10; label_y_factor=1.03
ggplot(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=npi_scale*max(npi_df$contact_reduction)) ) +
geom_hpline(aes(x=factor(ifr_all_inf),y=DIC,group=seedsize,color=factor(seedsize)),width=0.22, # group=CDR,alpha=factor(CDR)
position=position_dodge(width=1)) + scale_alpha_manual(values=c(0.4,0.55,0.7,0.85)) +
geom_vline(xintercept=(2:4)-0.5,size=0.2,linetype="dashed") + # facet_wrap(~seedsize,labeller=labeller(CDR=label_both),nrow = 3) +
scale_x_discrete(expand=expansion(0.1,0)) + # scale_y_log10() + # scale_y_continuous(breaks=seq(5,100,by=1)*100) +
theme_bw() + standard_theme +
theme(axis.text.x=element_text(vjust=0.5,hjust=0.95,size=12),axis.text.y=element_text(size=12),panel.grid.major.x=element_blank(),
legend.position="top",strip.text=element_text(size=15)) +
geom_text(aes(x=factor(ifr_all_inf),y=DIC+label_y_dodge,
group=seedsize,label=paste0(gsub("2019/|2020/","",gsub("-","/",introd_date)),",",R0_label)), # group=CDR
position=position_dodge(width=1),size=3) +
geom_text(aes(x=factor(ifr_all_inf),y=DIC-label_y_dodge,group=seedsize,label=paste0("NPI_eff:",round(npi_max_effect*100),"%")),
position=position_dodge(width=1),size=3) + xlab("IFR (%)") + ylab("DIC") + labs(color="seedsize",alpha="CDR")
ggplot(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=npi_scale*max(npi_df$contact_reduction)) ) +
geom_hpline(aes(x=factor(ifr_all_inf),y=DIC,group=seedsize,color=factor(seedsize)),width=0.22, # group=CDR,alpha=factor(CDR)
position=position_dodge(width=1)) + scale_alpha_manual(values=c(0.4,0.55,0.7,0.85)) +
geom_vline(xintercept=(2:4)-0.5,size=0.2,linetype="dashed") + # facet_wrap(~seedsize,labeller=labeller(CDR=label_both),nrow = 3) +
scale_x_discrete(expand=expansion(0.1,0)) + # scale_y_log10() + # scale_y_continuous(breaks=seq(5,100,by=1)*100) +
theme_bw() + standard_theme +
theme(axis.text.x=element_text(vjust=0.5,hjust=0.95,size=12),axis.text.y=element_text(size=12),panel.grid.major.x=element_blank(),
legend.position="top",strip.text=element_text(size=15)) +
geom_text(aes(x=factor(ifr_all_inf),y=DIC+label_y_dodge,
group=seedsize,label=paste0(gsub("2019/|2020/","",gsub("-","/",introd_date)),",",R0_label)), # group=CDR
position=position_dodge(width=1),size=4) +
geom_text(aes(x=factor(ifr_all_inf),y=DIC-label_y_dodge,group=seedsize,label=paste0("NPI_eff:",round(npi_max_effect*100),"%")),
position=position_dodge(width=1),size=4) + xlab("IFR (%)") + ylab("DIC") + labs(color="seedsize",alpha="CDR")
label_y_dodge=10; label_y_factor=1.03; fontsize=3.5
ggplot(fitting_params_best_estim %>% filter(ifr_all_inf<1.6 & seedsize>20) %>%
mutate(R0_label=paste0("R0=",round(R0_fit,1)),npi_max_effect=npi_scale*max(npi_df$contact_reduction)) ) +
geom_hpline(aes(x=factor(ifr_all_inf),y=DIC,group=seedsize,color=factor(seedsize)),width=0.22, # group=CDR,alpha=factor(CDR)
position=position_dodge(width=1)) + scale_alpha_manual(values=c(0.4,0.55,0.7,0.85)) +
geom_vline(xintercept=(2:4)-0.5,size=0.2,linetype="dashed") + # facet_wrap(~seedsize,labeller=labeller(CDR=label_both),nrow = 3) +
scale_x_discrete(expand=expansion(0.1,0)) + # scale_y_log10() + # scale_y_continuous(breaks=seq(5,100,by=1)*100) +
theme_bw() + standard_theme +
theme(axis.text.x=element_text(vjust=0.5,hjust=0.95,size=12),axis.text.y=element_text(size=12),panel.grid.major.x=element_blank(),
legend.position="top",strip.text=element_text(size=15)) +
geom_text(aes(x=factor(ifr_all_inf),y=DIC+label_y_dodge,
group=seedsize,label=paste0(gsub("2019/|2020/","",gsub("-","/",introd_date)),",",R0_label)), # group=CDR
position=position_dodge(width=1),size=fontsize) +
geom_text(aes(x=factor(ifr_all_inf),y=DIC-label_y_dodge,group=seedsize,label=paste0("NPI_eff:",round(npi_max_effect*100),"%")),
position=position_dodge(width=1),size=fontsize) + xlab("IFR (%)") + ylab("DIC") + labs(color="seedsize",alpha="CDR")
ggsave(paste0(parscan_mcmc_dirname,"DIC_xaxis_NPIscaling_colorcode_seedsize_alpha_CDR.png"),width=40,height=24,units="cm")
params$pop
params$pop[[1]]$dE
mean(params$pop[[1]]$dE)
ggplot(suscept_clinfract_posteriors %>% mutate(name=gsub("clin_fract","clinical fraction",name)),
aes(x=agegroup,y=value,group=1)) + geom_line() + geom_point() + ylab("proportion/normalised value") +
facet_wrap(~name,scales="free") + theme_bw() + scale_y_continuous(breaks=(2:20)/20)
head(suscept_clinfract_posteriors,2)
params$pop[[1]]$y
data.frame(name="clin_fract",age=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y)
params$pop[[1]]$u
data.frame(name="susceptibility",age=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)))
rbind(data.frame(name="clin_fract",age=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",age=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx"))
rbind(suscept_clinfract_posteriors,
rbind(data.frame(name="clin_fract",age=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",age=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx")))
rbind()
suscept_clinfract_posteriors
rbind(suscept_clinfract_posteriors %>% mutate(type="literature"),
rbind(data.frame(name="clin_fract",age=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",age=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx")))
rbind(data.frame(name="clin_fract",age=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",age=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx"))
rbind(suscept_clinfract_posteriors %>% mutate(type="literature")
suscept_clinfract_posteriors %>% mutate(type="literature")
head(suscept_clinfract_posteriors,2)
rbind(suscept_clinfract_posteriors %>% mutate(type="literature"),
rbind(data.frame(name="clin_fract",agegroup=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",agegroup=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx"))) %>%
mutate(name=gsub("clin_fract","clinical fraction",name))
ggplot(rbind(suscept_clinfract_posteriors %>% mutate(type="literature"),
rbind(data.frame(name="clin_fract",agegroup=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",agegroup=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx"))) %>%
mutate(name=gsub("clin_fract","clinical fraction",name)),
aes(x=agegroup,y=value,color=type)) + geom_line() + geom_point() + ylab("proportion/normalised value") +
facet_wrap(~name,scales="free") + theme_bw() + scale_y_continuous(breaks=(2:20)/20)
ggplot(rbind(suscept_clinfract_posteriors %>% mutate(type="literature"),
rbind(data.frame(name="clin_fract",agegroup=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",agegroup=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx"))) %>%
mutate(name=gsub("clin_fract","clinical fraction",name)),
aes(x=agegroup,y=value,color=type)) + geom_line() + geom_point() + ylab("proportion/normalised value") +
facet_wrap(~name,scales="free") + theme_bw() + scale_y_continuous(breaks=(2:20)/20)
ggplot(rbind(suscept_clinfract_posteriors %>% mutate(type="literature"),
rbind(data.frame(name="clin_fract",agegroup=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",agegroup=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx"))) %>%
mutate(name=gsub("clin_fract","clinical fraction",name)),
aes(x=agegroup,y=value,color=type)) + geom_line() + ylab("proportion/normalised value") + # + geom_point()
facet_wrap(~name,scales="free") + theme_bw() + scale_y_continuous(breaks=(2:20)/20)
susc_clinfract_plot=rbind(suscept_clinfract_posteriors %>% mutate(type="literature"),
rbind(data.frame(name="clin_fract",agegroup=suscept_clinfract_posteriors$agegroup,value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",agegroup=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx"))) %>%
mutate(name=gsub("clin_fract","clinical fraction",name))
susc_clinfract_plot
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type)) + geom_line() + ylab("proportion/normalised value") + # + geom_point()
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20)
View(susc_clinfract_plot)
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type)) + geom_line() + ylab("proportion/normalised value") + # + geom_point()
facet_wrap(~name,scales="free") + theme_bw() + standard_theme
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type)) + geom_line() + geom_point() + ylab("proportion/normalised value") + #
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20)
ggplot(susc_clinfract_plot) + geom_line(aes(x=agegroup,y=value,color=type))
ggplot(susc_clinfract_plot) + geom_line(aes(x=agegroup,y=value,color=type)) + geom_point() + ylab("proportion/normalised value") + #
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20)
ggplot(susc_clinfract_plot) + geom_line(aes(x=agegroup,y=value,color=type)) + ylab("proportion/normalised value") + #
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20)
ggplot(susc_clinfract_plot) + geom_line(aes(x=agegroup,y=value,color=type)) + ylab("proportion/normalised value") + #
facet_wrap(~name,scales="free")
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type)) + geom_line() + ylab("proportion/normalised value") + #
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20)
data.frame(name="susceptibility",agegroup=suscept_clinfract_posteriors$agegroup,value=c(rep(0.38,4),rep(0.8,12)),type="approx")
susc_clinfract_plot=rbind(suscept_clinfract_posteriors %>% mutate(type="literature"),
rbind(data.frame(name="clin_fract",agegroup=unique(suscept_clinfract_posteriors$agegroup),value=params$pop[[1]]$y,type="approx"),
data.frame(name="susceptibility",agegroup=unique(suscept_clinfract_posteriors$agegroup),value=c(rep(0.38,4),rep(0.8,12)),type="approx"))) %>%
mutate(name=gsub("clin_fract","clinical fraction",name))
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type)) + geom_line() + ylab("proportion/normalised value") + #
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20)
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type,group=1)) + geom_line() + ylab("proportion/normalised value") + #
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20)
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type,group=type)) + geom_line() + ylab("proportion/normalised value") + #
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20)
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type,group=type)) + geom_line() + geom_point() +
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20) + ylab("proportion/normalised value")
ggsave("simul_output/somalia/clinfract_susc_lit_approx.png",width=25,height=16,units="cm")
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type,group=type)) + geom_line() + geom_point() +
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20) +
theme(axis.text.x=element_text(vjust = 0.5)) + ylab("proportion/normalised value")
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type,group=type)) + geom_line() + geom_point() +
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20) +
theme(axis.text.x=element_text(vjust = 0.5,hjust=0)) + ylab("proportion/normalised value")
ggplot(susc_clinfract_plot,aes(x=agegroup,y=value,color=type,group=type)) + geom_line() + geom_point() +
facet_wrap(~name,scales="free") + theme_bw() + standard_theme + scale_y_continuous(breaks=(2:20)/20) +
theme(axis.text.x=element_text(vjust = 0.5)) + ylab("proportion/normalised value")
ggsave("simul_output/somalia/clinfract_susc_lit_approx.png",width=25,height=16,units="cm")
ggsave("simul_output/somalia/clinfract_susc_lit_approx.png",width=30,height=16,units="cm")
mean(params$pop[[1]]$dE)
1/mean(params$pop[[1]]$dE)
1/mean(params$pop[[1]]$dIp)
mean(params$pop[[1]]$dIp)
mean(params$pop[[1]]$dIs)
mean(params$pop[[1]]$dIa)
1/mean(params$pop[[1]]$dIa)
mean(rgamma(1e3,shape = 2.5,rate = 4))
mean(rgamma(1e3,shape = 2.5,scale = 4))
